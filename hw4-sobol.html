<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Caitlin Nordheim-Maestas">

<title>HW4 - Sobol</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw4-sobol_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw4-sobol_files/libs/quarto-html/quarto.js"></script>
<script src="hw4-sobol_files/libs/quarto-html/popper.min.js"></script>
<script src="hw4-sobol_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw4-sobol_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw4-sobol_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw4-sobol_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw4-sobol_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw4-sobol_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw4-sobol_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">HW4 - Sobol</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Caitlin Nordheim-Maestas </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="part-1-paper" class="level1">
<h1>Part 1: Paper</h1>
<p>The Houle et al.&nbsp;(2017) paper on snow model parameter sensitivity used Sobol sensitivity analysis to compare two types of snow models: one conceptual (SNOW-17) and one physically based (VIC) model. The parameter uncertainty has <strong>important implications for snow modelers who are developing these models, and for scientists interpreting these model results in the context of climate change</strong>. Specifically, the authors found that two parameters in the VIC model that have been historically fixed (<strong>the accumulation period albedo decay parameter</strong>, expA2, and the <strong>thaw period albedo parameter</strong>, expA1) are actually the two most sensitive model parameters and greatly effect the output snow water equivalent estimates from the model! This points to the importance of getting the best estimate possible for your specific system for the accumulation period albedo decay and thaw period albedo when implementing your models. Moreover, this analysis may even inspire future work to not fix these parameters, but to investigate making them vary with relevant other inputs. This paper’s ana;ysis into parameter uncertainty within the model can <strong>meaningfully impact the output estimate of snow water equivalent</strong>, which has large implications in hydrology, ecology, and society. Houle et al.&nbsp;sheds important light on the importance of accurate accumulation period albedo decay and thaw period albedo parameters for accurate snow water equivalent estimates. Thus, it is important for snow scientists to invest in accurate and precise satelite imagery to inform their albedo parameter choice. Additionally, in an operational context, it is important to consider the application of these models into systems with vastly different albedo patterns, and this work points to the importance of ensuring the parameter input is as good as it can be, due to the model’s sensitivity to it.</p>
</section>
<section id="part-2-atmospheric-conductance" class="level1">
<h1>Part 2: Atmospheric Conductance</h1>
<p>libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sensitivity)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a" class="level3">
<h3 class="anchored" data-anchor-id="a">a</h3>
<p><em>Use the Sobel approach to generate parameter values for the 4 parameters</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, we define the distribution of the parameters</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>np<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>k_o <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">mean=</span><span class="fl">0.1</span>,<span class="at">sd=</span><span class="fl">0.1</span><span class="sc">*</span><span class="fl">0.1</span>, <span class="at">n=</span>np) <span class="co"># assume that they are normally distributed with standard deviation of 1%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>k_d <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">mean=</span><span class="fl">0.7</span>, <span class="at">sd=</span><span class="fl">0.7</span><span class="sc">*</span><span class="fl">0.1</span>, <span class="at">n=</span>np) <span class="co"># assume that they are normally distributed with standard deviation of 1%</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">mean=</span><span class="dv">300</span>, <span class="at">sd=</span><span class="dv">50</span>, <span class="at">n=</span>np) <span class="co"># normally distributed with a mean of 300 cm/s with a standard deviation of 50 cm/s</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>height <span class="ot">=</span> <span class="fu">runif</span>(<span class="at">min=</span><span class="fl">3.5</span>, <span class="at">max=</span><span class="fl">5.5</span>, <span class="at">n=</span>np) <span class="co"># For vegetation height assume that height is somewhere between 3.5 and 5.5 m</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># now, we will make a combined dataframe for the parameter values</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">=</span> <span class="fu">cbind.data.frame</span>(k_o, k_d, v, <span class="at">height=</span>height)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="do">## next, we will do a repeat sampling, using the same distribution of the parameters!</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>np<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>k_o <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">mean=</span><span class="fl">0.1</span>,<span class="at">sd=</span><span class="fl">0.1</span><span class="sc">*</span><span class="fl">0.1</span>, <span class="at">n=</span>np) <span class="co"># assume that they are normally distributed with standard deviation of 1%</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>k_d <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">mean=</span><span class="fl">0.7</span>, <span class="at">sd=</span><span class="fl">0.7</span><span class="sc">*</span><span class="fl">0.1</span>, <span class="at">n=</span>np) <span class="co"># assume that they are normally distributed with standard deviation of 1%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">mean=</span><span class="dv">300</span>, <span class="at">sd=</span><span class="dv">50</span>, <span class="at">n=</span>np) <span class="co"># normally distributed with a mean of 300 cm/s with a standard deviation of 50 cm/s</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>height <span class="ot">=</span> <span class="fu">runif</span>(<span class="at">min=</span><span class="fl">3.5</span>, <span class="at">max=</span><span class="fl">5.5</span>, <span class="at">n=</span>np) <span class="co"># For vegetation height assume that height is somewhere between 3.5 and 5.5 m</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># now, we will make a combined dataframe for the parameter values</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">=</span> <span class="fu">cbind.data.frame</span>(k_o, k_d, v, <span class="at">height=</span>height)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="b" class="level3">
<h3 class="anchored" data-anchor-id="b">b</h3>
<p><em>Run the atmospheric conductance model for these parameters</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># source the conductance model</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"Catm.R"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">## run model over these parameter values ##</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># using sobolSalt here to generate the Sobol object "sens_Catm_Sobol"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># note, we will run the model outside and say model=NULL here, Naomi says it usually works better this way</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>sens_Catm_Sobol <span class="ot">=</span> <span class="fu">sobolSalt</span>(<span class="at">model =</span> <span class="cn">NULL</span>, X1, X2, <span class="at">nboot =</span> <span class="dv">100</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># run model for Sobol generated parameter sets and compute indices</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>parms <span class="ot">=</span> <span class="fu">as.data.frame</span>(sens_Catm_Sobol<span class="sc">$</span>X) <span class="co"># make a df that pulls the values from the X in the sobol object</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(parms)<span class="ot">=</span> <span class="fu">colnames</span>(X1) <span class="co"># this object had no column names, so pulling from my X1 created in the prior step</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># running the Catm function over the parms dataframe that I just created using pmap_dbl # in other words, run the model over these parameter values</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># output is "res" for results</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">pmap_dbl</span>(parms, Catm)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># using the tell function to "tell" the sensitivity object (sens_Catm_Sobol) about the results associated with each parameter set</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>sens_Catm_Sobol <span class="ot">=</span> sensitivity<span class="sc">::</span><span class="fu">tell</span>(sens_Catm_Sobol,res, <span class="at">res.names=</span><span class="st">"ga"</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># woohoo, we ran it! </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to look at the main effect, called "S" for Sobol</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># partitions variance (main effect without co-variance) - sums approximately to one</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># useful to add names</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(sens_Catm_Sobol<span class="sc">$</span>S) <span class="ot">=</span> <span class="fu">colnames</span>(parms)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>sens_Catm_Sobol<span class="sc">$</span>S</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        original          bias std. error  min. c.i. max. c.i.
k_o    0.1280736  3.334611e-03 0.03506407 0.06432475 0.2101580
k_d    0.1627961 -3.569696e-05 0.03462146 0.10692827 0.2485333
v      0.5107852  3.752112e-03 0.02334350 0.46254864 0.5615751
height 0.1133533  1.761161e-03 0.03266828 0.05051327 0.1849740</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># interpretation: </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># windspeed (v) has strongest main effect (0.5)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># meaning, uncertainty in kd has the biggest impact on the output</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># all parms but height are "significant" (CI does not cross zero EXCEPT height)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's check out the total effect (T)- accounts for parameter interactions</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(sens_Catm_Sobol<span class="sc">$</span>T) <span class="ot">=</span> <span class="fu">colnames</span>(parms) <span class="co"># give it names</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>sens_Catm_Sobol<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        original          bias  std. error min. c.i. max. c.i.
k_o    0.2017871 -0.0011673482 0.012165760 0.1756614 0.2277985
k_d    0.1945362  0.0001919743 0.011552079 0.1725937 0.2161249
v      0.5351524  0.0014280047 0.029641023 0.4704348 0.5859621
height 0.1263621 -0.0004350316 0.008262744 0.1102515 0.1433477</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># interpretation: </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># windspeed (v) has strongest total effect (0.5)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># meaning, uncertainty in kd has the biggest impact on the output</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># now, height is significant, as is everything else still</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># similar pattern to the main effect, but height is now significant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c" class="level3">
<h3 class="anchored" data-anchor-id="c">c</h3>
<p><em>Plot conductance estimates in a way that accounts for parameter uncertainty</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a dataframe with the parameter values and the output (gs)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>both <span class="ot">=</span> <span class="fu">cbind.data.frame</span>(parms, <span class="at">gs=</span>sens_Catm_Sobol<span class="sc">$</span>y)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># look at overall gs sensitvity to uncertainty</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(both, <span class="fu">aes</span>(<span class="at">x=</span>gs))<span class="sc">+</span><span class="fu">geom_histogram</span>()<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fu">mean</span>(both<span class="sc">$</span>gs), <span class="at">col=</span><span class="st">"yellow"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"Conductance estimate (mm/s)"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Conductance estimate sensitivity to parameter uncertainty"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw4-sobol_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="d" class="level3">
<h3 class="anchored" data-anchor-id="d">d</h3>
<p><em>Plot conductance estimates against windspeed use the parameter that is 2nd in terms of total effect on response</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># look at response of conductance to windspeed (the most important parameter according to the main effect and total effect)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># commented out, homework specified it wanted the next iteration</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(both, aes(v,gs))+geom_point()+labs(y="Conductance (mm/s)", x="k_d parameter")</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># now, add in color to show the second most sensitive parm, k_o</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># note, k_o just BARELY beats k_d in both maiin effect and total effect</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(both, <span class="fu">aes</span>(v,gs, <span class="at">col=</span>k_o))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">"Conductance (mm/s)"</span>, <span class="at">x=</span><span class="st">"windspeed parameter value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw4-sobol_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="e" class="level3">
<h3 class="anchored" data-anchor-id="e">e</h3>
<p><em>Estimate the Sobel Indices for your output</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time to look at the main effect, called "S" for Sobol</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># partitions variance (main effect without co-variance) - sums approximately to one</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sens_Catm_Sobol<span class="sc">$</span>S</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        original          bias std. error  min. c.i. max. c.i.
k_o    0.1280736  3.334611e-03 0.03506407 0.06432475 0.2101580
k_d    0.1627961 -3.569696e-05 0.03462146 0.10692827 0.2485333
v      0.5107852  3.752112e-03 0.02334350 0.46254864 0.5615751
height 0.1133533  1.761161e-03 0.03266828 0.05051327 0.1849740</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now let's check out the total effect (T)- accounts for parameter interactions</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sens_Catm_Sobol<span class="sc">$</span>T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        original          bias  std. error min. c.i. max. c.i.
k_o    0.2017871 -0.0011673482 0.012165760 0.1756614 0.2277985
k_d    0.1945362  0.0001919743 0.011552079 0.1725937 0.2161249
v      0.5351524  0.0014280047 0.029641023 0.4704348 0.5859621
height 0.1263621 -0.0004350316 0.008262744 0.1102515 0.1433477</code></pre>
</div>
</div>
</section>
<section id="f" class="level3">
<h3 class="anchored" data-anchor-id="f">f</h3>
<p><em>Comment on what this tells you about how atmospheric conductance and its sensitivity to variation in windspped differs in this setting as compared to the setting that we examined in class where windspeed was lower and less variable and vegetation was taller.</em></p>
<p>In our first analysis, in a system with higher and less variable windspeed and teller vegetation, we found that the the atmospheric conductance was actually MOST sensitive to the parameter k_d, the scalar for zero plane displacement (S (the main effect) for k_d = 0.53). The second most sensitive was windspeed, v (S for v = 0.21).</p>
<p>Interestingly, when we did this analysis in a system with shorter vegatation and lower but more variable windspeed, we found that the atmospheric conductance was <strong>most sensitive to windspeed</strong>, thus, <strong>in our system with lower vegetation and more variable windspeed, the windspeed parameter is more important in terms of model sensitivity</strong>. We found that the the atmospheric conductance was most sensitive to the parameter for windspeed, (S = 0.47, as opposed to the other system, where S= 0.21).</p>
<p>This analysis has <strong>strong implications for the use of the model in systems with different vegetation height and windspeed and variability</strong>, and how much to invest in accurate windspeed measurements. In a system with low vegetation and variable windspeed, the output is more sensitive to the windspeed. If I were to implement this model in this type of system, I would invest time and money into ensuring that my input values for the windspeed are as accurate as they can be, potentially by investing into better environmental loggers.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>