<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kat Le &amp; Caitlin Nordheim-Maestas">

<title>Assignment Calibrate Sagehen streamflow</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="week4-bonus-hw-Sagehen-assignment_files/libs/clipboard/clipboard.min.js"></script>
<script src="week4-bonus-hw-Sagehen-assignment_files/libs/quarto-html/quarto.js"></script>
<script src="week4-bonus-hw-Sagehen-assignment_files/libs/quarto-html/popper.min.js"></script>
<script src="week4-bonus-hw-Sagehen-assignment_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="week4-bonus-hw-Sagehen-assignment_files/libs/quarto-html/anchor.min.js"></script>
<link href="week4-bonus-hw-Sagehen-assignment_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="week4-bonus-hw-Sagehen-assignment_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="week4-bonus-hw-Sagehen-assignment_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="week4-bonus-hw-Sagehen-assignment_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="week4-bonus-hw-Sagehen-assignment_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment Calibrate Sagehen streamflow</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kat Le &amp; Caitlin Nordheim-Maestas </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="ecological-prelude-by-caitlin" class="level3">
<h3 class="anchored" data-anchor-id="ecological-prelude-by-caitlin">Ecological Prelude by Caitlin:</h3>
<p>(will be part of the paragraph at the end of the assignment, justifies why the month of July and why the max streamflow)</p>
<p>This data is taken from Sagehen Creek field station, a reserve that has a lot of research on birds, particularly interesting to us is the the MAPS program (<a href="https://www.birdpop.org/pages/maps.php" class="uri">https://www.birdpop.org/pages/maps.php</a>) which monitors many species of birds to model their populations. Many birds rely on emerging insects, like mayflies, as a food source. Mayflies tend to emerge en mass, so it is vital that the timing of the mayfly emergence lines up with when the bird predators are present, especially for migratory species. Additionally, it has been postulated that a reduced or increased stream flow can trigger changes in when mayflies emerge (a delay or early emergence, respectively). A delayed emergence could be detrimental to the birds relying on the mayfly food source, and thus, we will focus on the instances of high streamflow, the maximum, during the months of ecological relevance to mayfly emergence. Thus, we will be using the streamflow model outputs from the Sagehen creek models to determine <strong>which parameter set best predicts the maximum streamflow, and minimized the overall error in prediction of streamflow in the window of mayfly emergence (July)</strong></p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><a href="https://www.birdsasart-blog.com/baa/wp-content/gallery/general-2017/cache/crop-to-head-Cattle-Egret-with-mayfly-_A923730-Indian-Lake-Estates-FL-1.jpg-nggid048763-ngg0dyn-800x0x100-00f0w010c010r110f110r010t010.jpg"><img src="https://www.birdsasart-blog.com/baa/wp-content/gallery/general-2017/cache/crop-to-head-Cattle-Egret-with-mayfly-_A923730-Indian-Lake-Estates-FL-1.jpg-nggid048763-ngg0dyn-800x0x100-00f0w010c010r110f110r010t010.jpg" class="img-fluid figure-img" alt="photo of Cattle egret munching on a mayfly" width="300"></a></p>
<figcaption class="figure-caption">Cattle egret snacking on a mayfly; photo by Arthur Morris</figcaption>
</figure>
</div>
<p><em>Note to Kat: If we are feeling fancy, instead of doing the monthly maximum streamflow, maybe we could calculate the deviation from the mean of all years, that would be more ecologically relevant, but less easily to follow along with the example code, so let’s save this as an extra.</em></p>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<section id="part-1-make-the-function" class="level2">
<h2 class="anchored" data-anchor-id="part-1-make-the-function">Part 1 make the function</h2>
</section>
<section id="function-flow_metrics_mayflies" class="level2">
<h2 class="anchored" data-anchor-id="function-flow_metrics_mayflies">Function: flow_metrics_mayflies</h2>
<p>Goal: make a function that calculates the percent error of the model and true observations for 2 important indices for mayflies: (1) the entire month of mayfly emergence (2) the maximum water flow within that mayfly month. We will also output the correlation values for both indices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"flow_metrics_mayflies.R"</span>) <span class="co"># this is the function, will implement it in part 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Question for Kat: is this what the question was asking? I have 4 metrics, and it asked for 2…so hopefully it’s good enough!</em></p>
</section>
</section>
<section id="part-2" class="level1">
<h1>Part 2</h1>
<section id="libraries-data" class="level3">
<h3 class="anchored" data-anchor-id="libraries-data">libraries &amp; data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sensitivity)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># import data (note: I am a disorganized mess and keep everything in one folder so you'll prob have to update your file path)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># for Part 1 and getting data for part 2</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>sager <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"sager.txt"</span>, <span class="at">header=</span>T)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>msage <span class="ot">=</span> <span class="fu">read.table</span>(<span class="st">"sagerm.txt"</span>, <span class="at">header=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling">data wrangling</h3>
<section id="sager-wrangling" class="level4">
<h4 class="anchored" data-anchor-id="sager-wrangling">sager wrangling</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add date</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sager <span class="ot">=</span> sager <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">paste</span>(day,month,year, <span class="at">sep=</span><span class="st">"/"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>sager<span class="sc">$</span>date <span class="ot">=</span> <span class="fu">as.Date</span>(sager<span class="sc">$</span>date,<span class="st">"%d/%m/%Y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="msage-wrangling" class="level4">
<h4 class="anchored" data-anchor-id="msage-wrangling">msage wrangling</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets say we know the start date from our earlier output, as in lecture</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>msage<span class="sc">$</span>date <span class="ot">=</span> sager<span class="sc">$</span>date</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>msage<span class="sc">$</span>month <span class="ot">=</span> sager<span class="sc">$</span>month</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>msage<span class="sc">$</span>year <span class="ot">=</span> sager<span class="sc">$</span>year</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>msage<span class="sc">$</span>day <span class="ot">=</span> sager<span class="sc">$</span>day</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>msage<span class="sc">$</span>wy <span class="ot">=</span> sager<span class="sc">$</span>wy</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># let's explore the data</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(msage<span class="sc">$</span>wy) <span class="co"># 1966 - 1990 is water year range</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1966 1990</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(msage<span class="sc">$</span>month) <span class="co"># all months, numbered 1-12, so our months of interest will be 6 and 7 (June and July)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot our model simulations (code from lecture)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>msagel <span class="ot">=</span> msage <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">!</span><span class="fu">c</span>(date, month, year, day,wy), <span class="at">names_to=</span><span class="st">"run"</span>, <span class="at">values_to=</span><span class="st">"flow"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># let's look at 1970, because groovy</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">=</span><span class="fu">ggplot</span>(<span class="fu">subset</span>(msagel, wy <span class="sc">==</span> <span class="dv">1970</span>), <span class="fu">aes</span>(<span class="fu">as.Date</span>(date), flow, <span class="at">col=</span>run))<span class="sc">+</span><span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># lets add observed streamflow</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">data=</span><span class="fu">subset</span>(sager, wy <span class="sc">==</span> <span class="dv">1970</span>), <span class="fu">aes</span>(<span class="fu">as.Date</span>(date), obs), <span class="at">size=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">"Streamflow"</span>, <span class="at">x=</span><span class="st">"Date"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"simulated and observed data for 1970"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="week4-bonus-hw-Sagehen-assignment_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="split-sample-calibration-and-answers" class="level3">
<h3 class="anchored" data-anchor-id="split-sample-calibration-and-answers">split-sample calibration and answers</h3>
<p><strong>We are going to pretend we are a lab that only only has data from 1970-1980 years to train our data on.</strong></p>
<section id="outline-for-this-section" class="level4">
<h4 class="anchored" data-anchor-id="outline-for-this-section">Outline for this section:</h4>
</section>
</section>
<section id="step-0-create-a-combined-metric-not-sure-if-this-is-required-or-not-instructions-unclear" class="level3">
<h3 class="anchored" data-anchor-id="step-0-create-a-combined-metric-not-sure-if-this-is-required-or-not-instructions-unclear"><em>step 0: create a combined metric?? Not sure if this is required or not, instructions unclear</em></h3>
</section>
<section id="step-1-implement-the-function" class="level3">
<h3 class="anchored" data-anchor-id="step-1-implement-the-function">step 1 implement the function</h3>
<p>to compute performance measures for all output</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> msage <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>date, <span class="sc">-</span>month, <span class="sc">-</span>day, <span class="sc">-</span>year, <span class="sc">-</span>wy ) <span class="sc">%&gt;%</span> <span class="fu">map_df</span>(flow_metrics_mayflies, <span class="at">o=</span>sager<span class="sc">$</span>obs, <span class="at">month=</span>msage<span class="sc">$</span>month, <span class="at">day=</span>msage<span class="sc">$</span>day, <span class="at">year=</span>msage<span class="sc">$</span>year, <span class="at">wy=</span>msage<span class="sc">$</span>wy)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> mayfly_month_err  mayfly_month_cor mayfly_max_err     mayfly_max_cor  
 Min.   :-22.773   Min.   :0.6334   Min.   :-1.33457   Min.   :0.7079  
 1st Qu.:-18.847   1st Qu.:0.7809   1st Qu.:-1.04162   1st Qu.:0.8325  
 Median :-15.191   Median :0.8325   Median :-0.85564   Median :0.8581  
 Mean   :-12.980   Mean   :0.8203   Mean   :-0.81000   Mean   :0.8518  
 3rd Qu.: -9.680   3rd Qu.:0.8606   3rd Qu.:-0.58912   3rd Qu.:0.8762  
 Max.   :  8.039   Max.   :0.9450   Max.   :-0.02931   Max.   :0.9526  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graph range of performance measures</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>resl <span class="ot">=</span> res <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">"metric"</span>, <span class="at">values_to=</span><span class="st">"value"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resl, <span class="fu">aes</span>(metric, value))<span class="sc">+</span><span class="fu">geom_boxplot</span>()<span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>metric, <span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4-bonus-hw-Sagehen-assignment_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assign an identifier to each row, use the same identify for columns of original streamflow data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>run <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="fu">nrow</span>(res))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(msage)<span class="ot">=</span><span class="fu">c</span>(res<span class="sc">$</span>run, <span class="st">"date"</span>,<span class="st">"month"</span>,<span class="st">"year"</span>,<span class="st">"day"</span>,<span class="st">"wy"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># select the best model for which the error for predicting the maximum water flow is minimized</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>best <span class="ot">=</span> res[<span class="fu">which.min</span>(res<span class="sc">$</span>mayfly_max_err),]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>msagel  <span class="ot">=</span>  msage <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="sc">!</span><span class="fu">c</span>(date, month, year, day,wy), <span class="at">names_to=</span><span class="st">"run"</span>, <span class="at">values_to=</span><span class="st">"flow"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(msagel, run <span class="sc">==</span> best<span class="sc">$</span>run), <span class="fu">aes</span>(date, flow)) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="week4-bonus-hw-Sagehen-assignment_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## best is run 8!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="step-2-do-this-for-the-split-sample-calibration" class="level3">
<h3 class="anchored" data-anchor-id="step-2-do-this-for-the-split-sample-calibration">step 2: do this for the split-sample calibration</h3>
<p>(only 1970 - 1980), see lecture slide 33, I believe this will fulfill the requirement “Compute and plot how the performance of the model using the best parameter set changed in pre and post calibration periods (that you chose)” but I am not totally clear on the instructions</p>
</section>
<section id="step-3-determine-the-best-and-worst-model" class="level3">
<h3 class="anchored" data-anchor-id="step-3-determine-the-best-and-worst-model">step 3: determine the best AND worst model</h3>
<p>using similar code above (and on slide 41), input the <strong>best</strong> into the portal on Canvas</p>
</section>
<section id="step-4-graph-something-about-streamflow" class="level3">
<h3 class="anchored" data-anchor-id="step-4-graph-something-about-streamflow">step 4: “Graph something about streamflow…</h3>
<p>…(e.g daily, mean August, or ?) for the best parameter set”, I was thinking of maybe something where we can visualize the date the x axis, but it is only for July (maybe facet by year? what do you think?) and the flow predictions on the y axis and a line for the observed values as well (similar to the plot on slide 41).</p>
</section>
<section id="step-5-write-2-3-sentences" class="level3">
<h3 class="anchored" data-anchor-id="step-5-write-2-3-sentences">step 5: Write 2-3 sentences</h3>
<p>to explain your metric design and comment on model performance based on your metric</p>
<p>Here is my beginning, mainly metric justification:</p>
<p>This data is taken from Sagehen Creek field station, a reserve that has a lot of research on birds, particularly interesting to us is the the MAPS program (<a href="https://www.birdpop.org/pages/maps.php" class="uri">https://www.birdpop.org/pages/maps.php</a>) which monitors many species of birds to model their populations. Many birds rely on emerging insects, like mayflies, as a food source. Mayflies tend to emerge en mass, so it is vital that the timing of the mayfly emergence lines up with when the bird predators are present, especially for migratory species. Additionally, it has been postulated that a reduced or increased stream flow can trigger changes in when mayflies emerge (a delay or early emergence, respectively). A delayed emergence could be detrimental to the birds relying on the mayfly food source, and thus, we will focus on the instances of high streamflow, the maximum, during the months of ecological relevance to mayfly emergence. Thus, we will be using the streamflow model outputs from the Sagehen creek models to determine <strong>which parameter set best predicts the maximum streamflow in the window of mayfly emergence (June-July)</strong></p>
<p><strong>Caitlin to insert information on the model performance based on our metric here when we have finished</strong></p>
</section>
</section>
<section id="instructions-notes" class="level1">
<h1>Instructions &amp; notes</h1>
<section id="part-1-come-up-with-a-combined-metric-that-you-think-is-interesting" class="level2">
<h2 class="anchored" data-anchor-id="part-1-come-up-with-a-combined-metric-that-you-think-is-interesting">Part 1: Come up with a combined metric that you think is interesting</h2>
<ul>
<li>if you can, try to include at least one metric (as part of your combined metric) that needs to be transformed be creative you can subset, aggregate, focus only on particular type of years or days</li>
</ul>
<p><strong>Here, we will use the maximum streamflow events from the months of ecologcial relevance for mayfly emergence (June and July).</strong></p>
<p>Our metrics will be:</p>
<p>1: the model error in predicting the monthly maximum streamflow over the months June and July</p>
<p>2: Something else, maybe the model error in something else? Or maybe one of the classic ones like NSE? but if we do model error then they will be in the same units and easier to combine… maybe here is where we do the deviation from the juneJuly mean across all years?</p>
</section>
<section id="part-ii" class="level2">
<h2 class="anchored" data-anchor-id="part-ii">Part II</h2>
<ul>
<li><p>Perform a split-sample calibration on the Sagehen model output <strong>(sagerm.txt)</strong> you can decide what years to pick for pre and post calibration use your performance metric from Part I</p></li>
<li><p>Find the best and worst parameter set, given your performance metric Graph something about streamflow (e.g daily, mean August, or ?) for the best parameter set</p>
<p>* Compute and plot how the performance of the model using the best parameter set changed in pre and post calibration periods (that you chose)</p></li>
<li><p>Add the ‘best’ parameter set column number number to the quiz linked below (so we can compare how different metrics influence which parameter you pick)</p></li>
<li><p>Write 2-3 sentences to explain your metric design and comment on model performance based on your metric Use to Best Parameter (Column) to record your ‘best’ parameter sets</p></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>